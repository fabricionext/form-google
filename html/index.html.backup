<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Cliente - AppForm</title>
    
    <!-- Vuetify CSS -->
    <link href="https://unpkg.com/vuetify@3/dist/vuetify.min.css" rel="stylesheet">
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .form-card {
            border-radius: 20px !important;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1) !important;
        }
        
        .step-header {
            background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
        }
        
        .progress-container {
            padding: 24px;
            background: rgba(25, 118, 210, 0.05);
        }
        
        .section-divider {
            margin: 24px 0;
            border-color: rgba(25, 118, 210, 0.2) !important;
        }
        
        .step-content {
            padding: 32px;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .field-group {
            background: rgba(25, 118, 210, 0.02);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border: 1px solid rgba(25, 118, 210, 0.1);
        }
        
        .pj-fields {
            background: rgba(156, 39, 176, 0.02);
            border-color: rgba(156, 39, 176, 0.1);
        }
    </style>
</head>
<body>
    <div id="app">
        <v-app>
            <v-main>
                <div class="container">
                    <div class="fade-in">
                        <v-card class="form-card" elevation="0">
                            <!-- Header -->
                            <v-card-title class="step-header text-h4 text-center py-6">
                                <v-icon icon="mdi-account-plus" class="me-3" size="large"></v-icon>
                                Cadastro de Cliente
                            </v-card-title>
                            
                            <!-- Progress Bar -->
                            <div class="progress-container">
                                <v-progress-linear
                                    :model-value="progressoFormulario"
                                    height="8"
                                    rounded
                                    color="primary"
                                    bg-color="grey-lighten-3"
                                ></v-progress-linear>
                                <div class="text-center mt-2 text-caption">
                                    {{ Math.round(progressoFormulario) }}% Completo
                                </div>
                            </div>
                            
                            <div class="step-content">
                                <v-form ref="form" v-model="valid" @submit.prevent="submitForm">
                                    
                                    <!-- SEÇÃO 1: TIPO DE PESSOA -->
                                    <div class="field-group">
                                        <v-card-subtitle class="text-h6 font-weight-bold mb-4 pa-0">
                                            <v-icon icon="mdi-account-group" class="me-2" color="primary"></v-icon>
                                            1. Tipo de Pessoa
                                        </v-card-subtitle>
                                        
                                        <v-radio-group 
                                            v-model="cliente.tipo_pessoa" 
                                            :rules="[rules.required]"
                                            inline
                                            @update:model-value="onTipoPessoaChange"
                                        >
                                            <v-radio 
                                                label="Pessoa Física" 
                                                value="FISICA"
                                                color="primary"
                                            ></v-radio>
                                            <v-radio 
                                                label="Pessoa Jurídica" 
                                                value="JURIDICA"
                                                color="secondary"
                                            ></v-radio>
                                        </v-radio-group>
                                    </div>

                                    <!-- SEÇÃO 2: DADOS PESSOAIS -->
                                    <div class="field-group" :class="{ 'pj-fields': cliente.tipo_pessoa === 'JURIDICA' }">
                                        <v-card-subtitle class="text-h6 font-weight-bold mb-4 pa-0">
                                            <v-icon icon="mdi-account" class="me-2" :color="cliente.tipo_pessoa === 'JURIDICA' ? 'purple' : 'primary'"></v-icon>
                                            2. {{ cliente.tipo_pessoa === 'JURIDICA' ? 'Dados da Empresa' : 'Dados Pessoais' }}
                                        </v-card-subtitle>
                                        
                                        <!-- Pessoa Física -->
                                        <div v-if="cliente.tipo_pessoa === 'FISICA'">
                                            <v-row>
                                                <v-col cols="12" md="6">
                                                    <v-text-field
                                                        v-model="cliente.primeiro_nome"
                                                        label="Nome *"
                                                        :rules="[rules.required]"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-account"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                                <v-col cols="12" md="6">
                                                    <v-text-field
                                                        v-model="cliente.sobrenome"
                                                        label="Sobrenome *"
                                                        :rules="[rules.required]"
                                                        variant="outlined"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                            </v-row>
                                            
                                            <v-row>
                                                <v-col cols="12" md="4">
                                                    <v-text-field
                                                        v-model="cliente.nacionalidade"
                                                        label="Nacionalidade"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-flag"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                                <v-col cols="12" md="4">
                                                    <v-select
                                                        v-model="cliente.estado_civil"
                                                        :items="estadosCivis"
                                                        label="Estado Civil"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-heart"
                                                        @update:model-value="updateProgress"
                                                    ></v-select>
                                                </v-col>
                                                <v-col cols="12" md="4">
                                                    <v-text-field
                                                        v-model="cliente.profissao"
                                                        label="Profissão"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-briefcase"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                            </v-row>
                                            
                                            <v-row>
                                                <v-col cols="12" md="6">
                                                    <v-text-field
                                                        v-model="cliente.data_nascimento"
                                                        label="Data de Nascimento *"
                                                        type="date"
                                                        :rules="[rules.required]"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-calendar"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                            </v-row>
                                        </div>
                                        
                                        <!-- Pessoa Jurídica -->
                                        <div v-if="cliente.tipo_pessoa === 'JURIDICA'">
                                            <v-row>
                                                <v-col cols="12">
                                                    <v-text-field
                                                        v-model="cliente.razao_social"
                                                        label="Razão Social *"
                                                        :rules="[rules.required]"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-domain"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                            </v-row>
                                            
                                            <v-row>
                                                <v-col cols="12" md="6">
                                                    <v-text-field
                                                        v-model="cliente.nome_fantasia"
                                                        label="Nome Fantasia"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-store"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                                <v-col cols="12" md="6">
                                                    <v-text-field
                                                        v-model="cliente.inscricao_estadual"
                                                        label="Inscrição Estadual"
                                                        variant="outlined"
                                                        prepend-inner-icon="mdi-file-document"
                                                        @input="updateProgress"
                                                    ></v-text-field>
                                                </v-col>
                                            </v-row>
                                        </div>
                                    </div>

                                    <!-- SEÇÃO 3: ENDEREÇO -->
                                    <div class="field-group">
                                        <v-card-subtitle class="text-h6 font-weight-bold mb-4 pa-0">
                                            <v-icon icon="mdi-map-marker" class="me-2" color="primary"></v-icon>
                                            3. Endereço
                                        </v-card-subtitle>
                                        
                                        <v-row>
                                            <v-col cols="12" md="3">
                                                <v-text-field
                                                    v-model="cliente.endereco_cep"
                                                    label="CEP *"
                                                    :rules="[rules.required]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-map-marker"
                                                    @input="aplicarMascaraCEP"
                                                    @blur="buscarCEP"
                                                    :loading="carregandoCEP"
                                                    maxlength="9"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="7">
                                                <v-text-field
                                                    v-model="cliente.endereco_logradouro"
                                                    label="Logradouro *"
                                                    :rules="[rules.required]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-road"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="2">
                                                <v-text-field
                                                    v-model="cliente.endereco_numero"
                                                    label="Número *"
                                                    :rules="[rules.required]"
                                                    variant="outlined"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                        </v-row>
                                        
                                        <v-row>
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.endereco_complemento"
                                                    label="Complemento"
                                                    variant="outlined"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.endereco_bairro"
                                                    label="Bairro *"
                                                    :rules="[rules.required]"
                                                    variant="outlined"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.endereco_cidade"
                                                    label="Cidade *"
                                                    :rules="[rules.required]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-city"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                        </v-row>
                                        
                                        <v-row>
                                            <v-col cols="12" md="6">
                                                <v-select
                                                    v-model="cliente.endereco_estado"
                                                    :items="estados"
                                                    label="Estado *"
                                                    :rules="[rules.required]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-map"
                                                    @update:model-value="updateProgress"
                                                ></v-select>
                                            </v-col>
                                        </v-row>
                                    </div>

                                    <!-- SEÇÃO 4: DOCUMENTOS -->
                                    <div class="field-group">
                                        <v-card-subtitle class="text-h6 font-weight-bold mb-4 pa-0">
                                            <v-icon icon="mdi-card-account-details" class="me-2" color="primary"></v-icon>
                                            4. Documentos
                                        </v-card-subtitle>
                                        
                                        <v-row v-if="cliente.tipo_pessoa === 'FISICA'">
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.cpf"
                                                    label="CPF *"
                                                    :rules="[rules.required, rules.cpf]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-card-account-details"
                                                    @input="aplicarMascaraCPF"
                                                    maxlength="14"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.rg_numero"
                                                    label="RG"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-card-account-details-outline"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4">
                                                <v-select
                                                    v-model="cliente.rg_uf_emissor"
                                                    :items="estadosSiglas"
                                                    label="Estado Emissor RG"
                                                    variant="outlined"
                                                    @update:model-value="updateProgress"
                                                ></v-select>
                                            </v-col>
                                        </v-row>
                                        
                                        <v-row v-if="cliente.tipo_pessoa === 'JURIDICA'">
                                            <v-col cols="12" md="6">
                                                <v-text-field
                                                    v-model="cliente.cnpj"
                                                    label="CNPJ *"
                                                    :rules="[rules.required, rules.cnpj]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-domain"
                                                    @input="aplicarMascaraCNPJ"
                                                    maxlength="18"
                                                ></v-text-field>
                                            </v-col>
                                        </v-row>
                                        
                                        <v-row v-if="cliente.tipo_pessoa === 'FISICA'">
                                            <v-col cols="12" md="6">
                                                <v-text-field
                                                    v-model="cliente.cnh_numero"
                                                    label="CNH"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-car"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                        </v-row>
                                    </div>

                                    <!-- SEÇÃO 5: CONTATO -->
                                    <div class="field-group">
                                        <v-card-subtitle class="text-h6 font-weight-bold mb-4 pa-0">
                                            <v-icon icon="mdi-phone" class="me-2" color="primary"></v-icon>
                                            5. Contato
                                        </v-card-subtitle>
                                        
                                        <v-row>
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.telefone_celular"
                                                    label="Telefone Celular *"
                                                    :rules="[rules.required]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-cellphone"
                                                    @input="aplicarMascaraTelefone"
                                                    maxlength="15"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.telefone_outro"
                                                    label="Telefone Outro"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-phone"
                                                    @input="aplicarMascaraTelefoneFixo"
                                                    maxlength="14"
                                                ></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4">
                                                <v-text-field
                                                    v-model="cliente.email"
                                                    label="E-mail *"
                                                    type="email"
                                                    :rules="[rules.required, rules.email]"
                                                    variant="outlined"
                                                    prepend-inner-icon="mdi-email"
                                                    @input="updateProgress"
                                                ></v-text-field>
                                            </v-col>
                                        </v-row>
                                    </div>

                                    <!-- Botão de Envio -->
                                    <v-row class="mt-6">
                                        <v-col cols="12" class="text-center">
                                            <v-btn
                                                type="submit"
                                                color="primary"
                                                size="x-large"
                                                :loading="loading"
                                                :disabled="!valid || progressoFormulario < 70"
                                                class="px-12 py-4"
                                                rounded="xl"
                                                elevation="4"
                                            >
                                                <v-icon icon="mdi-content-save" class="me-2"></v-icon>
                                                Cadastrar Cliente
                                            </v-btn>
                                            
                                            <div class="text-caption mt-2" v-if="progressoFormulario < 70">
                                                Complete pelo menos 70% do formulário para enviar
                                            </div>
                                        </v-col>
                                    </v-row>
                                </v-form>
                                
                                <!-- Mensagem de Feedback -->
                                <v-alert
                                    v-if="mensagem"
                                    :type="tipoMensagem"
                                    variant="tonal"
                                    class="mt-6"
                                    closable
                                    @click:close="mensagem = ''"
                                    rounded="lg"
                                >
                                    <template v-slot:prepend>
                                        <v-icon 
                                            :icon="tipoMensagem === 'success' ? 'mdi-check-circle' : 
                                                   tipoMensagem === 'error' ? 'mdi-alert-circle' : 'mdi-information'"
                                        ></v-icon>
                                    </template>
                                    {{ mensagem }}
                                </v-alert>
                            </div>
                        </v-card>
                    </div>
                </div>
            </v-main>
        </v-app>
    </div>

    <!-- Vue.js and Vuetify from CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/vuetify@3/dist/vuetify.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        const { createApp, ref, reactive, computed, onMounted, watch } = Vue;
        const { createVuetify } = Vuetify;

        // Configuração do Vuetify
        const vuetify = createVuetify({
            theme: {
                defaultTheme: 'light',
                themes: {
                    light: {
                        colors: {
                            primary: '#1976d2',
                            secondary: '#9c27b0',
                            accent: '#82B1FF',
                            error: '#FF5252',
                            info: '#2196F3',
                            success: '#4CAF50',
                            warning: '#FFC107',
                        },
                    },
                },
            },
        });

        // Composables
        function useFormValidation() {
            const rules = {
                required: value => !!value || 'Este campo é obrigatório',
                email: value => {
                    const pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return pattern.test(value) || 'E-mail inválido';
                },
                cpf: value => {
                    if (!value) return true;
                    const cpf = value.replace(/\D/g, '');
                    return cpf.length === 11 || 'CPF deve ter 11 dígitos';
                },
                cnpj: value => {
                    if (!value) return true;
                    const cnpj = value.replace(/\D/g, '');
                    return cnpj.length === 14 || 'CNPJ deve ter 14 dígitos';
                },
            };

            return { rules };
        }

        function useCliente() {
            const cliente = reactive({
                tipo_pessoa: 'FISICA',
                primeiro_nome: '',
                sobrenome: '',
                razao_social: '',
                nome_fantasia: '',
                nacionalidade: 'Brasileira',
                estado_civil: '',
                profissao: '',
                data_nascimento: '',
                endereco_cep: '',
                endereco_logradouro: '',
                endereco_numero: '',
                endereco_complemento: '',
                endereco_bairro: '',
                endereco_cidade: '',
                endereco_estado: '',
                cpf: '',
                cnpj: '',
                rg_numero: '',
                rg_orgao_emissor: 'SSP',
                rg_uf_emissor: '',
                cnh_numero: '',
                inscricao_estadual: '',
                telefone_celular: '',
                telefone_outro: '',
                email: '',
            });

            const limparFormulario = () => {
                Object.assign(cliente, {
                    tipo_pessoa: 'FISICA',
                    primeiro_nome: '',
                    sobrenome: '',
                    razao_social: '',
                    nome_fantasia: '',
                    nacionalidade: 'Brasileira',
                    estado_civil: '',
                    profissao: '',
                    data_nascimento: '',
                    endereco_cep: '',
                    endereco_logradouro: '',
                    endereco_numero: '',
                    endereco_complemento: '',
                    endereco_bairro: '',
                    endereco_cidade: '',
                    endereco_estado: '',
                    cpf: '',
                    cnpj: '',
                    rg_numero: '',
                    rg_orgao_emissor: 'SSP',
                    rg_uf_emissor: '',
                    cnh_numero: '',
                    inscricao_estadual: '',
                    telefone_celular: '',
                    telefone_outro: '',
                    email: '',
                });
            };

            return { cliente, limparFormulario };
        }

        function useProgress(cliente) {
            const progressoFormulario = computed(() => {
                const campos = cliente.tipo_pessoa === 'FISICA' ? 
                    ['tipo_pessoa', 'primeiro_nome', 'sobrenome', 'data_nascimento', 'endereco_cep', 
                     'endereco_logradouro', 'endereco_numero', 'endereco_bairro', 'endereco_cidade', 
                     'endereco_estado', 'cpf', 'telefone_celular', 'email'] :
                    ['tipo_pessoa', 'razao_social', 'endereco_cep', 'endereco_logradouro', 'endereco_numero', 
                     'endereco_bairro', 'endereco_cidade', 'endereco_estado', 'cnpj', 'telefone_celular', 'email'];
                
                const preenchidos = campos.filter(campo => 
                    cliente[campo] && cliente[campo].toString().trim() !== ''
                ).length;
                
                return (preenchidos / campos.length) * 100;
            });

            return { progressoFormulario };
        }

        function useMasks(cliente, updateProgress) {
            const aplicarMascaraCPF = (event) => {
                let valor = event.target.value.replace(/\D/g, '');
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                cliente.cpf = valor;
                updateProgress();
            };

            const aplicarMascaraCNPJ = (event) => {
                let valor = event.target.value.replace(/\D/g, '');
                valor = valor.replace(/(\d{2})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d)/, '$1/$2');
                valor = valor.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
                cliente.cnpj = valor;
                updateProgress();
            };

            const aplicarMascaraTelefone = (event) => {
                let valor = event.target.value.replace(/\D/g, '');
                if (valor.length <= 10) {
                    valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
                    valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
                } else {
                    valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
                    valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
                }
                cliente.telefone_celular = valor;
                updateProgress();
            };

            const aplicarMascaraTelefoneFixo = (event) => {
                let valor = event.target.value.replace(/\D/g, '');
                valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
                valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
                cliente.telefone_outro = valor;
                updateProgress();
            };

            const aplicarMascaraCEP = (event) => {
                let valor = event.target.value.replace(/\D/g, '');
                valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
                cliente.endereco_cep = valor;
                updateProgress();
            };

            return {
                aplicarMascaraCPF,
                aplicarMascaraCNPJ,
                aplicarMascaraTelefone,
                aplicarMascaraTelefoneFixo,
                aplicarMascaraCEP
            };
        }

        function useCEP(cliente, updateProgress) {
            const carregandoCEP = ref(false);

            const buscarCEP = async () => {
                const cep = cliente.endereco_cep.replace(/\D/g, '');
                
                if (cep.length !== 8) return;

                carregandoCEP.value = true;

                try {
                    const response = await axios.get(`/api/cep/${cep}`);
                    
                    if (response.data && !response.data.erro) {
                        cliente.endereco_logradouro = response.data.logradouro || '';
                        cliente.endereco_bairro = response.data.bairro || '';
                        cliente.endereco_cidade = response.data.localidade || '';
                        cliente.endereco_estado = response.data.uf || '';
                        updateProgress();
                    }
                } catch (error) {
                    console.error('Erro ao buscar CEP:', error);
                } finally {
                    carregandoCEP.value = false;
                }
            };

            return { carregandoCEP, buscarCEP };
        }

        function useConstants() {
            const estadosCivis = [
                { title: 'Solteiro(a)', value: 'SOLTEIRO' },
                { title: 'Casado(a)', value: 'CASADO' },
                { title: 'Divorciado(a)', value: 'DIVORCIADO' },
                { title: 'Viúvo(a)', value: 'VIUVO' },
                { title: 'Separado(a)', value: 'SEPARADO' },
                { title: 'União Estável', value: 'UNIAO_ESTAVEL' },
            ];

            const estados = [
                { title: 'Acre - AC', value: 'AC' },
                { title: 'Alagoas - AL', value: 'AL' },
                { title: 'Amapá - AP', value: 'AP' },
                { title: 'Amazonas - AM', value: 'AM' },
                { title: 'Bahia - BA', value: 'BA' },
                { title: 'Ceará - CE', value: 'CE' },
                { title: 'Distrito Federal - DF', value: 'DF' },
                { title: 'Espírito Santo - ES', value: 'ES' },
                { title: 'Goiás - GO', value: 'GO' },
                { title: 'Maranhão - MA', value: 'MA' },
                { title: 'Mato Grosso - MT', value: 'MT' },
                { title: 'Mato Grosso do Sul - MS', value: 'MS' },
                { title: 'Minas Gerais - MG', value: 'MG' },
                { title: 'Pará - PA', value: 'PA' },
                { title: 'Paraíba - PB', value: 'PB' },
                { title: 'Paraná - PR', value: 'PR' },
                { title: 'Pernambuco - PE', value: 'PE' },
                { title: 'Piauí - PI', value: 'PI' },
                { title: 'Rio de Janeiro - RJ', value: 'RJ' },
                { title: 'Rio Grande do Norte - RN', value: 'RN' },
                { title: 'Rio Grande do Sul - RS', value: 'RS' },
                { title: 'Rondônia - RO', value: 'RO' },
                { title: 'Roraima - RR', value: 'RR' },
                { title: 'Santa Catarina - SC', value: 'SC' },
                { title: 'São Paulo - SP', value: 'SP' },
                { title: 'Sergipe - SE', value: 'SE' },
                { title: 'Tocantins - TO', value: 'TO' },
            ];

            const estadosSiglas = [
                'AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA',
                'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN',
                'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'
            ];

            return { estadosCivis, estados, estadosSiglas };
        }

        function useFormSubmission(cliente, limparFormulario) {
            const loading = ref(false);
            const mensagem = ref('');
            const tipoMensagem = ref('success');

            const submitForm = async () => {
                loading.value = true;
                mensagem.value = '';

                try {
                    // Preparar dados conforme tipo de pessoa
                    const dadosEnvio = { ...cliente };
                    
                    // Remover campos não aplicáveis
                    if (cliente.tipo_pessoa === 'FISICA') {
                        delete dadosEnvio.razao_social;
                        delete dadosEnvio.nome_fantasia;
                        delete dadosEnvio.cnpj;
                        delete dadosEnvio.inscricao_estadual;
                    } else {
                        delete dadosEnvio.primeiro_nome;
                        delete dadosEnvio.sobrenome;
                        delete dadosEnvio.cpf;
                        delete dadosEnvio.rg_numero;
                        delete dadosEnvio.rg_orgao_emissor;
                        delete dadosEnvio.rg_uf_emissor;
                        delete dadosEnvio.data_nascimento;
                        delete dadosEnvio.estado_civil;
                        delete dadosEnvio.profissao;
                        delete dadosEnvio.cnh_numero;
                    }

                    const response = await axios.post('/api/public/clientes', dadosEnvio);

                    mensagem.value = 'Cliente cadastrado com sucesso!';
                    tipoMensagem.value = 'success';
                    limparFormulario();
                    
                } catch (error) {
                    console.error('Erro ao cadastrar cliente:', error);
                    tipoMensagem.value = 'error';

                    if (error.response && error.response.data) {
                        if (error.response.data.details) {
                            const erros = Object.values(error.response.data.details).flat();
                            mensagem.value = 'Erro de validação: ' + erros.join(', ');
                        } else {
                            mensagem.value = error.response.data.message || 'Erro ao cadastrar cliente';
                        }
                    } else {
                        mensagem.value = 'Erro de conexão. Tente novamente.';
                    }
                } finally {
                    loading.value = false;
                }
            };

            return { loading, mensagem, tipoMensagem, submitForm };
        }

        // Componente principal
        const app = createApp({
            setup() {
                // Refs e reactive data
                const form = ref(null);
                const valid = ref(false);

                // Composables
                const { rules } = useFormValidation();
                const { cliente, limparFormulario } = useCliente();
                const { progressoFormulario } = useProgress(cliente);
                const { estadosCivis, estados, estadosSiglas } = useConstants();
                
                // Função para atualizar progresso
                const updateProgress = () => {
                    // O progresso é computed automaticamente
                };

                const { aplicarMascaraCPF, aplicarMascaraCNPJ, aplicarMascaraTelefone, aplicarMascaraTelefoneFixo, aplicarMascaraCEP } = useMasks(cliente, updateProgress);
                const { carregandoCEP, buscarCEP } = useCEP(cliente, updateProgress);
                const { loading, mensagem, tipoMensagem, submitForm } = useFormSubmission(cliente, limparFormulario);

                // Função para mudança de tipo de pessoa
                const onTipoPessoaChange = () => {
                    if (cliente.tipo_pessoa === 'FISICA') {
                        cliente.razao_social = '';
                        cliente.nome_fantasia = '';
                        cliente.cnpj = '';
                        cliente.inscricao_estadual = '';
                    } else {
                        cliente.primeiro_nome = '';
                        cliente.sobrenome = '';
                        cliente.cpf = '';
                        cliente.rg_numero = '';
                        cliente.data_nascimento = '';
                        cliente.estado_civil = '';
                        cliente.profissao = '';
                        cliente.cnh_numero = '';
                    }
                };

                // Lifecycle
                onMounted(() => {
                    console.log('Vue app mounted successfully with Composition API');
                });

                return {
                    // Refs
                    form,
                    valid,
                    
                    // Data
                    cliente,
                    progressoFormulario,
                    loading,
                    carregandoCEP,
                    mensagem,
                    tipoMensagem,
                    
                    // Constants
                    estadosCivis,
                    estados,
                    estadosSiglas,
                    rules,
                    
                    // Methods
                    aplicarMascaraCPF,
                    aplicarMascaraCNPJ,
                    aplicarMascaraTelefone,
                    aplicarMascaraTelefoneFixo,
                    aplicarMascaraCEP,
                    buscarCEP,
                    updateProgress,
                    onTipoPessoaChange,
                    submitForm
                };
            }
        });

        app.use(vuetify);
        app.mount('#app');
    </script>
</body>
</html>