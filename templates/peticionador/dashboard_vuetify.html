{% extends "_base_peticionador_vuetify.html" %} {% block title %}Dashboard -
Peticionador{% endblock %} {% block content %}
<div class="fade-in">
  <!-- Header Section -->
  <v-row class="mb-6">
    <v-col cols="12">
      <div class="d-flex justify-space-between align-center">
        <div>
          <h1 class="text-h4 font-weight-bold text-primary mb-2">
            <v-icon icon="mdi-view-dashboard" class="me-3"></v-icon>
            Dashboard do Peticionador
          </h1>
          <p class="text-body-1 text-medium-emphasis">
            Gerencie petições, modelos e clientes através do painel de controle
          </p>
        </div>
        <v-chip
          color="success"
          size="large"
          variant="elevated"
          prepend-icon="mdi-check-circle"
        >
          Sistema Ativo
        </v-chip>
      </div>
    </v-col>
  </v-row>

  <!-- Welcome Card -->
  <v-row class="mb-6">
    <v-col cols="12">
      <v-card color="primary" variant="tonal" class="custom-card">
        <v-card-text class="pa-6">
          <div class="d-flex align-center">
            <v-avatar color="primary" size="64" class="me-4">
              <v-icon icon="mdi-account" size="32" color="white"></v-icon>
            </v-avatar>
            <div>
              <h2 class="text-h5 font-weight-bold mb-2">
                <v-icon icon="mdi-hand-wave" class="me-2 text-warning"></v-icon>
                Bem-vindo(a),
                <strong>{{ current_user.name or current_user.email }}</strong>!
              </h2>
              <p class="text-body-1 mb-0">
                Gerencie petições, modelos e clientes através do painel de
                controle.
              </p>
            </div>
          </div>
        </v-card-text>
      </v-card>
    </v-col>
  </v-row>

  <!-- Metrics Cards -->
  <v-row class="mb-8">
    <v-col cols="12" md="4">
      <v-card
        class="custom-card gradient-primary text-white"
        elevation="4"
        @click="navigateTo('{{ url_for('peticionador.listar_clientes') }}')"
        style="cursor: pointer"
      >
        <v-card-text class="pa-6">
          <div class="d-flex align-center justify-space-between">
            <div>
              <h3 class="text-h6 font-weight-medium mb-2">Clientes</h3>
              <h2 class="text-h3 font-weight-bold">{{ total_clientes }}</h2>
            </div>
            <v-icon
              icon="mdi-account-group"
              size="48"
              class="opacity-75"
            ></v-icon>
          </div>
        </v-card-text>
      </v-card>
    </v-col>

    <v-col cols="12" md="4">
      <v-card class="custom-card gradient-success text-white" elevation="4">
        <v-card-text class="pa-6">
          <div class="d-flex align-center justify-space-between">
            <div>
              <h3 class="text-h6 font-weight-medium mb-2">Petições Geradas</h3>
              <h2 class="text-h3 font-weight-bold">{{ total_peticoes }}</h2>
            </div>
            <v-icon
              icon="mdi-file-document"
              size="48"
              class="opacity-75"
            ></v-icon>
          </div>
        </v-card-text>
      </v-card>
    </v-col>

    <v-col cols="12" md="4">
      <v-card class="custom-card gradient-warning text-white" elevation="4">
        <v-card-text class="pa-6">
          <div class="d-flex align-center justify-space-between">
            <div>
              <h3 class="text-h6 font-weight-medium mb-2">Usuários Ativos</h3>
              <h2 class="text-h3 font-weight-bold">{{ total_usuarios }}</h2>
            </div>
            <v-icon
              icon="mdi-account-check"
              size="48"
              class="opacity-75"
            ></v-icon>
          </div>
        </v-card-text>
      </v-card>
    </v-col>
  </v-row>

  <!-- Quick Actions -->
  <v-row class="mb-8">
    <v-col cols="12">
      <h3 class="text-h5 font-weight-bold mb-4">
        <v-icon icon="mdi-lightning-bolt" class="me-2 text-warning"></v-icon>
        Ações Rápidas
      </h3>

      <v-row>
        <v-col cols="12" md="4">
          <v-card
            class="custom-card"
            elevation="2"
            @click="navigateTo('{{ url_for('peticionador.selecionar_modelo_peticao') }}')"
            style="cursor: pointer"
          >
            <v-card-text class="pa-6 text-center">
              <v-icon
                icon="mdi-file-plus"
                size="48"
                color="primary"
                class="mb-4"
              ></v-icon>
              <h4 class="text-h6 font-weight-medium mb-2">Nova Petição</h4>
              <p class="text-body-2 text-medium-emphasis">
                Crie uma nova petição usando modelos predefinidos
              </p>
            </v-card-text>
          </v-card>
        </v-col>

        <v-col cols="12" md="4">
          <v-card
            class="custom-card"
            elevation="2"
            @click="navigateTo('{{ url_for('peticionador.listar_modelos') }}')"
            style="cursor: pointer"
          >
            <v-card-text class="pa-6 text-center">
              <v-icon
                icon="mdi-layer-group"
                size="48"
                color="secondary"
                class="mb-4"
              ></v-icon>
              <h4 class="text-h6 font-weight-medium mb-2">Modelos</h4>
              <p class="text-body-2 text-medium-emphasis">
                Gerencie modelos de documentos e petições
              </p>
            </v-card-text>
          </v-card>
        </v-col>

        <v-col cols="12" md="4">
          <v-card
            class="custom-card"
            elevation="2"
            @click="navigateTo('{{ url_for('peticionador.listar_autoridades') }}')"
            style="cursor: pointer"
          >
            <v-card-text class="pa-6 text-center">
              <v-icon
                icon="mdi-shield-account"
                size="48"
                color="info"
                class="mb-4"
              ></v-icon>
              <h4 class="text-h6 font-weight-medium mb-2">Autoridades</h4>
              <p class="text-body-2 text-medium-emphasis">
                Configure autoridades e órgãos competentes
              </p>
            </v-card-text>
          </v-card>
        </v-col>
      </v-row>
    </v-col>
  </v-row>

  <!-- Recent Activity -->
  <v-row>
    <v-col cols="12">
      <h3 class="text-h5 font-weight-bold mb-4">
        <v-icon icon="mdi-clock-outline" class="me-2 text-info"></v-icon>
        Atividade Recente
      </h3>

      <v-card elevation="2">
        {% if atividade_recente %}
        <v-card-text class="pa-0">
          <v-data-table
            :headers="[
                                { title: 'Formulário', key: 'nome', sortable: true },
                                { title: 'Modelo', key: 'modelo', sortable: true },
                                { title: 'Criado em', key: 'criado_em', sortable: true },
                                { title: 'Ações', key: 'acoes', sortable: false }
                            ]"
            :items="atividadeData"
            :items-per-page="10"
            class="elevation-0"
          >
            <template v-slot:item.nome="{ item }">
              <div class="d-flex align-center">
                <v-icon
                  icon="mdi-file-document"
                  color="primary"
                  class="me-2"
                ></v-icon>
                <strong>{{ item.nome }}</strong>
              </div>
            </template>

            <template v-slot:item.modelo="{ item }">
              <v-chip color="secondary" size="small" variant="tonal">
                {{ item.modelo }}
              </v-chip>
            </template>

            <template v-slot:item.criado_em="{ item }">
              <span class="text-caption text-medium-emphasis">
                {{ item.criado_em }}
              </span>
            </template>

            <template v-slot:item.acoes="{ item }">
              <v-btn
                icon="mdi-open-in-new"
                size="small"
                color="primary"
                variant="text"
                :href="item.url"
                title="Acessar formulário"
              ></v-btn>
            </template>
          </v-data-table>
        </v-card-text>
        {% else %}
        <v-card-text class="pa-8 text-center">
          <v-icon
            icon="mdi-inbox"
            size="64"
            color="grey-lighten-1"
            class="mb-4"
          ></v-icon>
          <h4 class="text-h6 text-grey-darken-1 mb-2">
            Nenhuma atividade recente
          </h4>
          <p class="text-body-2 text-grey-darken-1">
            Os últimos formulários criados aparecerão aqui
          </p>
        </v-card-text>
        {% endif %}
      </v-card>
    </v-col>
  </v-row>
</div>

{% endblock %}

{% block scripts %}
<script>
  // Dados da atividade recente para o Vuetify Data Table
  const atividadeData = [
      {% for formulario in atividade_recente %}
      {
          nome: '{{ formulario.nome }}',
          modelo: '{{ formulario.modelo.nome }}',
          criado_em: '{{ formulario.criado_em.strftime('%d/%m/%Y %H:%M') }}',
          url: '{{ url_for('peticionador.preencher_formulario_dinamico', formulario_slug=formulario.slug) }}'
      }{% if not loop.last %},{% endif %}
      {% endfor %}
  ];

  // Aguardar o Vue app estar pronto e adicionar dados
  document.addEventListener('DOMContentLoaded', function() {
    // Aguardar um pouco para o Vue app ser inicializado
    setTimeout(function() {
      if (window.vueApp && window.vueApp._instance) {
        // Adicionar dados de atividade ao componente
        window.vueApp._instance.data.atividadeData = atividadeData;
      }
    }, 100);
  });
</script>
{% endblock %}
